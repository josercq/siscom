<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISCOM – Sistema de Gestão de Compras Escolares</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div id="site-header"></div>

    <main>
        <section class="banner" style="background: linear-gradient(rgba(242, 244, 246, 0.7), rgba(242, 244, 246, 0.8)), url('img/banner-bg.jpg'); background-size: cover; background-position: center;">
            <div class="container">
                <h1 id="banner-title">Sistema de Gestão de Compras Escolares</h1>
                <p id="banner-text">Transparência, eficiência e aproximação entre escolas e fornecedores locais.</p>
            </div>
        </section>

        <section class="stats-panel" id="stats-section">
            <div class="container">
                <div class="stats-grid">
                    <div class="stat-item">
                        <h3 id="stat-1-val">+77</h3>
                        <p id="stat-1-label">Fornecedores Cadastrados</p>
                    </div>
                    <div class="stat-item">
                        <h3 id="stat-2-val">R$ 850 mil</h3>
                        <p id="stat-2-label">Valor Total de Compras</p>
                    </div>
                    <div class="stat-item">
                        <h3 id="stat-3-val">35</h3>
                        <p id="stat-3-label">Oportunidades Abertas</p>
                    </div>
                    <div class="stat-item">
                        <h3 id="stat-4-val">42</h3>
                        <p id="stat-4-label">Escolas (APMs) Ativas</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="features" class="features-section section-padding">
            <div class="container">
                <h2 class="section-title">Soluções para Fornecedores</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <i class="fas fa-user-plus"></i>
                        <h3>Cadastre-se e forneça</h3>
                        <p>Crie seu perfil gratuito e tenha acesso às demandas das escolas de Cubatão.</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-paper-plane"></i>
                        <h3>Envie orçamentos online</h3>
                        <p>Participe de cotações de forma digital, rápida e sem burocracia.</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-bell"></i>
                        <h3>Receba notificações</h3>
                        <p>Seja avisado sobre novas oportunidades de negócio na sua área de atuação.</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-history"></i>
                        <h3>Histórico de propostas</h3>
                        <p>Acompanhe o status de todas as suas propostas enviadas em um painel único.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="opportunities-section section-padding">
            <div class="container">
                <h2 class="section-title" id="opp-section-title">Oportunidades Recentes</h2>

                <div class="responsive-table" id="public-table-container">
                    <table id="opportunities-table-index" role="table">
                        <thead>
                            <tr>
                                <th scope="col">Escola</th>
                                <th scope="col">Objeto do Serviço</th>
                                <th scope="col">Encerramento</th>
                                <th scope="col">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>UME Profª Helena Duarte</td>
                                <td>Manutenção e Limpeza de Ar Condicionado</td>
                                <td>30/12/2025</td>
                                <td><span class="status status-aberto">Aberto</span></td>
                            </tr>
                            <tr>
                                <td>CRECHE Saulo Gomes de Vargas</td>
                                <td>Dedetização e Controle de Pragas</td>
                                <td>03/12/2025</td>
                                <td><span class="status status-aberto">Aberto</span></td>
                            </tr>
                            <tr>
                                <td>UME Padre Antônio Ribeiro Filho</td>
                                <td>Poda de Árvores e Jardinagem</td>
                                <td>28/12/2025</td>
                                <td><span class="status status-aberto">Aberto</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="index-opportunities-grid" class="opportunities-grid" style="display: none;">
                    </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <a href="oportunidades.html" class="btn btn-primary" id="btn-view-all">Ver todas as oportunidades</a>
                </div>
            </div>
        </section>

        <section id="desenvolvimento" class="development-section section-padding">
            <div class="container">
                <h2 class="section-title">Desenvolvimento do Projeto</h2>
                <div class="dev-grid">
                    <div class="dev-card">
                        <h3>Conceito</h3>
                        <p>
                            O SISCOM é uma plataforma inovadora que visa modernizar a gestão de compras nas escolas municipais de Cubatão, proporcionando maior transparência e agilidade no processo de contratação de fornecedores locais.
                        </p>
                    </div>
                    <div class="dev-card">
                        <h3>Inspiração</h3>
                        <p>
                            A arquitetura da informação e o fluxo de processos foram baseados em sistemas governamentais de sucesso, como o <strong>Contrata+</strong> e o <strong>Compras.gov.br</strong>. Buscou-se adaptar a robustez dessas plataformas para uma interface simplificada e amigável.
                        </p>
                    </div>
                    <div class="dev-card">
                        <h3>Desenvolvimento</h3>
                        <p>
                            Projeto de TCC desenvolvido pelos alunos do curso Técnico em Informática da Etec de Cubatão.<br><br>
                            <strong>Alunos<br></strong>Fellipe Ferreira Araujo<br>José Roberto Candido<br>                            
                            <strong>2025</strong>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section id="faq" class="faq-section section-padding">
            <div class="container">
                <h2 class="section-title">Perguntas Frequentes</h2>
                <div class="faq-accordion">
                    <div class="faq-item">
                        <div class="faq-item-header">O que é o SISCOM? <i class="fas fa-chevron-down"></i></div>
                        <div class="faq-item-body"><div class="faq-item-body-content"><p>O SISCOM é o Sistema de Gestão de Compras Escolares da Prefeitura de Cubatão. Ele conecta fornecedores locais às APMs para cotação e compra de bens e serviços.</p></div></div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-item-header">Sou fornecedor. Como me cadastro? <i class="fas fa-chevron-down"></i></div>
                        <div class="faq-item-body"><div class="faq-item-body-content"><p>Basta clicar no botão "Seja um Fornecedor" nesta página ou no formulário de contato abaixo. O cadastro é gratuito e rápido.</p></div></div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-item-header">Preciso pagar alguma taxa? <i class="fas fa-chevron-down"></i></div>
                        <div class="faq-item-body"><div class="faq-item-body-content"><p>Não. O uso da plataforma é 100% gratuito tanto para as escolas quanto para os fornecedores.</p></div></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="contact" class="contact-section section-padding">
            <div class="container">
                <h2 class="section-title">Fale Conosco ou Cadastre-se</h2>
                <form id="contact-form" class="contact-form">
                    <div class="form-group">
                        <label for="name">Nome Completo / Razão Social <span class="required">*</span></label>
                        <input type="text" id="name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">E-mail <span class="required">*</span></label>
                        <input type="email" id="email" required>
                    </div>
                    <div class="form-group">
                        <label for="subject">Assunto <span class="required">*</span></label>
                        <select id="subject" required>
                            <option value="">Selecione...</option>
                            <option value="cadastro_fornecedor">Quero ser um fornecedor</option>
                            <option value="duvida_apm">Dúvida (sou da APM)</option>
                            <option value="suporte_tecnico">Suporte Técnico</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="message">Mensagem <span class="required">*</span></label>
                        <textarea id="message" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Enviar Mensagem</button>
                </form>
            </div>
        </section>

    </main>

    <div id="site-footer"></div>

    <script src="inc/header-footer.js"></script>
    <script src="jsmain.js"></script>
    
    <div id="custom-modal-overlay">
        <div class="custom-modal-box">
            <div class="custom-modal-icon"><i class="fas fa-check-circle"></i></div>
            <h3 id="popup-title">Mensagem Enviada!</h3>
            <p id="popup-text">Recebemos seu contato com sucesso.</p>
            <button id="custom-modal-close" class="custom-close-btn">Fechar</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const user = JSON.parse(sessionStorage.getItem("siscom_user"));
            
            // Verifica se é APM
            if (user && user.role === 'apm') {
                // 1. Altera o título da seção
                const title = document.getElementById("opp-section-title");
                if (title) title.innerText = "Minhas Oportunidades (Gestão)";
                
                // 2. Esconde a tabela pública
                const publicTable = document.getElementById("public-table-container");
                if (publicTable) publicTable.style.display = "none";
                
                // 3. Mostra a grid
                const grid = document.getElementById("index-opportunities-grid");
                if (grid) {
                    grid.style.display = "grid"; // ou flex, dependendo do CSS, mas grid é o padrão da classe
                    
                    // 4. Carrega as oportunidades (fixas + criadas pela APM)
                    const seedOpps = JSON.parse(localStorage.getItem("siscom_data_v7")) || [];
                    const savedOpps = JSON.parse(localStorage.getItem("siscom_custom_opps")) || [];
                    const allOpps = [...seedOpps, ...savedOpps];


                    // Filtra apenas as oportunidades da escola logada e que estejam em aberto (normalizado)
                    function normalizeForCompare(s) { return (s||'').toString().trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, ''); }
                    const myOpenOpps = allOpps.filter(o => normalizeForCompare(o.school) === normalizeForCompare(user.name) && o.status === 'aberto');

                    // Exemplo fixo para demonstrar funcionalidade se não houver nada salvo
                    if(myOpenOpps.length === 0) {
                       grid.innerHTML = `
                            <div style="grid-column: 1/-1; text-align: center; color: #666; padding: 20px;">
                                <p>Você ainda não cadastrou nenhuma oportunidade nova.</p>
                                <a href="oportunidades.html" class="btn btn-secondary" style="margin-top:10px;">Ir para o Painel</a>
                            </div>
                       `;
                    } else {
                        // Renderiza os cards
                        let cardsHTML = "";
                        myOpenOpps.forEach(opp => {
                            cardsHTML += `
                                <div class="opp-card">
                                    <div class="opp-card-header">
                                        <div class="opp-icon"><i class="${opp.icon}"></i></div>
                                        <div class="opp-school">${opp.school}</div>
                                    </div>
                                    <h3 class="opp-title">${opp.title}</h3>
                                    <p class="opp-desc">${(opp.description || '').substring(0, 80)}...</p>
                                    <div class="opp-footer">
                                        <div class="opp-meta">
                                            <span><i class="far fa-calendar-alt"></i> Até ${opp.expiry}</span>
                                            <span><i class="fas fa-map-marker-alt"></i> ${opp.location}</span>
                                        </div>

                                        <a href="gerenciar-oportunidade.html?id=${encodeURIComponent(opp.id || '')}" class="btn-details">Gerenciar</a>
                                    </div>
                                </div>
                            `;
                        });
                        grid.innerHTML = cardsHTML;
                    }
                }
            }
        });
    </script>

</body>
</html>